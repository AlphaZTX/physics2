% \iffalse meta-comment
%
% Copyright (C) 2022-2024 by Zhang Tingxuan <alphaztx@163.com>
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either
% version 1.3c of this license or (at your option) any later
% version. The latest version of this license is in:
%
%   http://www.latex-project.org/lppl.txt
%
% and version 1.3 or later is part of all distributions of
% LaTeX version 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
%
% The Current Maintainer of this work is Zhang Tingxuan.
%
% This work consists of the files physics2-code.dtx,
%                                 physics2-code.src.<collection>.dtx,
%           and the derived files physics2.ins,
%                                 physics2.sty,
%                                 phys.<module>.sty,
%                                 physics2-code.pdf,
%                             and README.md.
%
%<*internal>
\iffalse
%</internal>
%
%<*readme>
# The `physics2` package

This package defines commands for typesetting math formulae faster and
more simply. `physics2` is a modularized package, each module provides its
own function while the package itself only provides very few functions.
You can load modules of `physics2` after loading the `physics2` package.

## Functions and usages

See `physics2.pdf`.

## Build

Run

```
./build.sh
```

## For developers and deep users

If you want to contribute to this repo, you can

- pull requests [here](https://github.com/AlphaZTX/physics2/pulls);
- report bugs or request enhancement [here](https://github.com/AlphaZTX/physics2/issues).

Before committing, please read `physics2-code.pdf` first.

## License

This work may be distributed and/or modified under the conditions of the
[LaTeX Project Public License](http://www.latex-project.org/lppl.txt),
either version 1.3c of this license or (at your option) any later version.

This work has the LPPL maintenance status `maintained`.

The Current Maintainer of this work is
[Zhang Tingxuan](https://www.ctan.org/author/zhang-tx).

%</readme>
%
%<*internal>
\fi
\begingroup
  \def\NameOfLaTeXe{LaTeX2e}
\expandafter\endgroup\ifx\NameOfLaTeXe\fmtname\else
\csname fi\endcsname
%</internal>
%
%<*install>
\input docstrip.tex
\keepsilent

\preamble

 Copyright (C) 2022-2024 by Zhang Tingxuan <alphaztx@163.com>

 This work may be distributed and/or modified under the
 conditions of the LaTeX Project Public License, either
 version 1.3c of this license or (at your option) any later
 version. The latest version of this license is in:

   http://www.latex-project.org/lppl.txt

 and version 1.3 or later is part of all distributions of
 LaTeX version 2005/12/01 or later.

 This work has the LPPL maintenance status `maintained'.

 The Current Maintainer of this work is Zhang Tingxuan.

 This work consists of the files physics2-code.dtx,
                                 physics2-code.src.<collection>.dtx,
           and the derived files physics2.ins,
                                 physics2.sty,
                                 phys.<module>.sty,
                                 physics2-code.pdf,
                             and README.md.

\endpreamble

\generate{
  \usedir{tex/latex/physics2}
    \file{physics2.sty}          {\from{physics2-code.src.base.dtx}{package}}
    \file{phys.patch.amsmath.sty} {\from{physics2-code.src.base.dtx}{patch.amsmath}}
    \file{phys.ab.sty}            {\from{physics2-code.src.ab.dtx}{ab}}
    \file{phys.xab.sty}           {\from{physics2-code.src.ab.dtx}{xab}}
    \file{phys.ab.legacy.sty}     {\from{physics2-code.src.ab.dtx}{ab.legacy}}
    \file{phys.ab.braket.sty}     {\from{physics2-code.src.braket.dtx}{ab.braket}}
    \file{phys.braket.sty}        {\from{physics2-code.src.braket.dtx}{braket}}
    \file{phys.xmat.sty}          {\from{physics2-code.src.matrix.dtx}{xmat}}
    \file{phys.diagmat.sty}       {\from{physics2-code.src.matrix.dtx}{diagmat}}
    \file{phys.doubleprod.sty}    {\from{physics2-code.src.operator.dtx}{doubleprod}}
    \file{phys.diffop.sty}        {\from{physics2-code.src.operator.dtx}{diffop}}
    \file{phys.nabla.legacy.sty}  {\from{physics2-code.src.operator.dtx}{nabla.legacy}}
    \file{phys.op.legacy.sty}     {\from{physics2-code.src.operator.dtx}{op.legacy}}
    \file{phys.bm-um.legacy.sty}  {\from{physics2-code.src.misc.dtx}{bm-um.legacy}}
    \file{phys.qtext.legacy.sty}  {\from{physics2-code.src.misc.dtx}{qtext.legacy}}
    \file{phys.helper.sty}        {\from{physics2-code.src.helper.dtx}{helper}}
%</install>
%<*internal>
  \usedir{source/latex/physics2}
    \file{physics2.ins}          {\from{physics2-code.dtx}{install}}
%</internal>
%<*install>
  \usedir{doc/latex/physics2}
  \nopreamble\nopostamble
    \file{README.md}             {\from{physics2-code.dtx}{readme}}
}

\obeyspaces
\Msg{**********************************************************}
\Msg{*                                                        *}
\Msg{*  To finish the installation you have to move the       *}
\Msg{*  following files into a directory searched by TeX:     *}
\Msg{*                                                        *}
\Msg{*                    physics2.sty,                       *}
\Msg{*  (for all modules) phys.<module>.sty.                   *}
\Msg{*                                                        *}
\Msg{*  The recommended directory is                          *}
\Msg{*    TEXMFDIST/tex/latex/physics2                        *}
\Msg{*                                                        *}
\Msg{*  To produce the documentation, run the file            *}
\Msg{*  physics2-code.dtx through XeLaTeX or LuaLaTeX.        *}
\Msg{*  XeLaTeX is recommended.                               *}
\Msg{*                                                        *}
\Msg{*  Happy TeXing!                                         *}
\Msg{*                                                        *}
\Msg{**********************************************************}

\endbatchfile
%</install>
%
%<*internal>
\fi
%</internal>
%
%<*driver>
\ProvidesFile{physics2-code.dtx}[2024/01/22 (c) Copyright 2022-2024 by Zhang Tingxuan]
\documentclass{l3doc}
\hypersetup{hidelinks}
\definecolor{pkg}{RGB}{0,120,80}
\definecolor{mod}{RGB}{0,0,150}
\definecolor{gray}{rgb}{.5,.5,.5}
\DeclareRobustCommand\pkg[1]{\texorpdfstring{\textcolor{pkg}{\textsf{#1}}}{“#1”}}
\DeclareRobustCommand\modu[1]{\texorpdfstring{\textcolor{mod}{\textsf{#1}}}{“#1”}}
\usepackage{amsmath,fontspec,physics2}
\setmonofont{cmunbtl}[Extension=.otf,ItalicFont=cmunbto,BoldFont=cmuntt,BoldItalicFont=cmunst]
\fvset{gobble=2,fontsize=\small,numbers=left,numbersep=0pt,vspace=\MacrocodeTopsep,xleftmargin=\MacroIndent}
\makeatletter
\renewcommand\theFancyVerbLine{{\color{gray}\sffamily\tiny\ifnum\c@FancyVerbLine=1
  EXAMPLE\quad\fi\arabic{FancyVerbLine}}\ }
\def\@getver#1 #2 #3\fin{#1\quad#2}
\xdef\@date{\expandafter\expandafter\expandafter\@getver\csname ver@physics2.sty\endcsname\fin}
\@addtoreset{CodelineNo}{section}
\def\DeclareSourceFile#1{%
  \markright{Source file: \texttt{physics2-code.src.#1.dtx}}%
  \part{physics2-code.src.#1.dtx}%
  \markright{Source file: \texttt{physics2-code.src.#1.dtx}}%
}
\def\ps@phy{%
  \def\@oddfoot{\rightmark\hfil\thepage}%
  \let\@oddhead\relax%
  \let\@mkboth\markboth
}
%% BEGIN
\newbox\@tempboxb
\DeclareDocumentCommand\macrodef{O{4em}O{.6}mo+m}{\leavevmode
\ensuremath{%
  \setbox\@tempboxa\hbox to #1 {\hss\cs{#3}}%
  \setbox\@tempboxb\vbox{\hsize=#2\textwidth
    \textwidth=\hsize
    \leftskip=\z@
    \parindent=\z@
    \textbf{begindef}\IfValueT{#4}{ \textcolor{gray}{(#4)}}\par
    \begingroup\leftskip2em\parindent-1em#5\par\endgroup
    \textbf{enddef}%
  }%
  \dp\@tempboxb=\dimexpr\ht\@tempboxb-\ht\@tempboxa\relax
  \ht\@tempboxb=\ht\@tempboxa
  \box\@tempboxa\leftarrow\box\@tempboxb
}}
\protected\long\def\macroifelse#1#2#3{\par
  \textbf{if} #1 \textbf{then}\par
  \begingroup\advance\leftskip1em#2\par\endgroup
  \textbf{else}\par
  \begingroup\advance\leftskip1em#3\par\endgroup
  \textbf{endif}\par
}
\protected\long\def\macroif#1#2{\par
  \textbf{if} #1 \textbf{then}\par
  \begingroup\advance\leftskip1em#2\par\endgroup
  \textbf{endif}\par
}
\protected\def\macrocr{\par}
\newdimen\ttwd
\protected\def\updatettwd{%
  \setbox\@tempboxa\hbox{\normalsize\ttfamily a}
  \ttwd=\wd\@tempboxa
}
\updatettwd
%% END
\ExplSyntaxOn
\seq_new:N \l__phydoc_tmpa_seq
\seq_new:N \l__phydoc_tmpb_seq
\prg_set_conditional:Npnn \__codedoc_if_macro_internal:n #1 { p , T , F , TF }
  {
    \bool_if:NTF \l__codedoc_macro_internal_bool
      { \prg_return_true: }
      { \prg_return_false: }
  }
\DeclareDocumentCommand \relatedint { m }
  { \par { \small\textbf{Related~internal~command(s):}~ \relatedint_auxi:n {#1} . } \par }
\cs_new:Npn \relatedint_auxi:n #1
  {
    \seq_set_from_clist:Nn \l__phydoc_tmpa_seq {#1}
    \seq_set_map:NNn \l__phydoc_tmpb_seq \l__phydoc_tmpa_seq { \cs{##1} }
    \seq_use:Nnnn \l__phydoc_tmpb_seq { ~and~ } { ,~ } { ,~and~ }
  }
\ExplSyntaxOff
\makeatother
\title{Code documentation to the \pkg{physics2} package}
\author{Zhang Tingxuan\\\url{https://www.github.com/AlphaZTX/physics2}}
\date{2025/03/01 v2.0.0}
\begin{document}
  \maketitle
  \begin{abstract}
  This document tells how to write a module of \pkg{physics2} and gives notes
  on the code of \pkg{physics2} and its modules.
  \end{abstract}
  \tableofcontents\newpage
  \pagestyle{phy}
  \DocInput{physics2-code.src.base.dtx}
  \DocInput{physics2-code.src.ab.dtx}
  \DocInput{physics2-code.src.braket.dtx}
  \DocInput{physics2-code.src.matrix.dtx}
  \DocInput{physics2-code.src.operator.dtx}
  \DocInput{physics2-code.src.misc.dtx}
  \DocInput{physics2-code.src.helper.dtx}
  \clearpage
  \PrintIndex
\end{document}
%</driver>
% \fi
% 
